<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Optimizely Experiment</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://www.contentstack.com/sdks/contentstack-ui-extensions/dist/latest/ui-extension-sdk.css" rel="stylesheet" type="text/css" media="all">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://assets.contentstack.io/v3/assets/blte08a9a0af1c1320b/bltf24633929b28f9db/5b69788896ee083e4a2ce449/ui-extensions-sdk.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="https://www.contentstack.com/sdks/contentstack-ui-extensions/dist/1.1.0/ui-extension-sdk.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://getbootstrap.com/dist/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style media="all">
.container,.delete-container,.edit-container,.experiment-container,.new-experiment-container{display:none}.experiment-data tr:hover,.experiment-list tr:hover,.fa:hover{background:#f5fbfc!important}.details,.key{white-space:nowrap;text-overflow:ellipsis}body{line-height:1}.container,.row{margin-top:10px}.new-experiment{padding-right:5px;padding-top:5px}.details,.edit,.key,.keyName,.result,.weight{color:#748590;font-size:14px}.details:hover{cursor:pointer}.labell{padding:10px 15px 0;color:#474747;font-size:20px}.table-responsive{margin-top:10px;border-left:none!important;border-right:none!important}thead tr th{color:#4f6471;font-size:15px;font-weight:100;vertical-align:middle!important}.table>tbody>tr>td{vertical-align:middle}.table>tbody>tr>td>p{margin-bottom:0!important}.fa:hover{opacity:1!important}.action,.cpbtn,.result-icon{border:1px solid #d1dfe2;background:#fff;text-decoration:none;color:#748590 background-color: #fff;padding:10px;font-weight:400;line-height:1px}.action:hover{border-color:#c6d4d7}.fa{color:#748590!important;background-color:#fff!important;font-size:14px!important;opacity:.7}.disabled{opacity:.5}.goBack{float:left;margin-left:-15px;padding-right:8px}.add,.add:hover,.goBack,.goBack:hover{background-color:#FFF;cursor:pointer}.key{max-width:150px;overflow:hidden;width:70%}.refresh{font-size:17px!important}.plus{font-size:16px!important}.refresh-btn{float:right;padding-top:5px}.details{overflow:hidden;max-width:170px}.audiences,.experiment-key,.variations{margin:30px 0}.audienceLabel,.keyLabel,.variationLabel{margin:10px 0;color:#4f6471;font-size:15px}.audienceLabel{margin:10px 0 15px}.keyLabel{font-size:20px}.keyName{margin:10px 0}.table-striped>tbody>tr:nth-child(odd){background-color:#FFF}.link,.user{border:none;background:#fff;line-height:1px}.experiment-key{display:inline}#loader{display:none;margin-left:45%;margin-top:50%}.back{font-size:25px!important;margin-right:0}.keyLabel{margin-top:0;padding-top:10px}.audienceLabel a{text-decoration:none!important;color:#4f6471}.user{float:left;padding:0 2px 0 0}.link{padding:0 2px 0 4px}
</style>
</head>

<body>
    <div id="loader" class="reference-loading">
        <div class="loading-flash">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="labell">List of Experiments</div>
            <div class="new-experiment"><a href target="_blank"><button data-toggle="tooltip" title="Add/Edit Expeiment" type="button" class="btn add"><i class="plus fa fa-pencil" aria-hidden="true"></i></button></a></div>
            <div class="refresh-btn"><button data-toggle="tooltip" title="Refresh" type="button" class="btn add"><i class="refresh fa fa-refresh"></i></button></div>
            <div class="col-md-12">
                <div class="table-responsive list">
                    <table id="mytable" class="table table-bordred table-striped">
                        <thead>
                            <th>Expeiment Name</th>
                            <th>Action</th>
                            <th>Result</th>
                        </thead>
                        <tbody class="experiment-list">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


        <div class="experiment-container" id="edit" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
            <div class="experiment-details">
                <div class="experiment-key">
                </div>
                <div class="variations">
                    <div class="variationLabel">Variations & Traffic Distribution</div>
                    <div class="table-responsive detail">
                        <table class="table table-bordred table-striped">
                            <thead>
                                <th>Key</th>
                                <th></th>
                                <th>Traffic <br> Distribution</th>
                            </thead>
                            <tbody class="experiment-data">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="audiences">
                </div>

            </div>
        </div>
    </div>

    <script>
"use strict";var _createClass=function(){function i(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,a){return e&&i(t.prototype,e),a&&i(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var extensionField=void 0,audiences=void 0,clipboardJS=new ClipboardJS(".cpbtn"),optimizely=void 0,Optimizely=function(){function i(t){var e=t.access_token,a=t.project_id;_classCallCheck(this,i),this.ProjectId=a,this.AccessToken=e}return _createClass(i,[{key:"getAllExperiments",value:function(){var n=this,s=void 0;return new Promise(function(e,a){var t={Authorization:"Bearer "+n.AccessToken},i="https://api.optimizely.com/v2/experiments?project_id="+n.ProjectId;fetch(i,{method:"GET",headers:t}).then(function(t){return s=t.status,t.json()}).then(function(t){throw 200===s&&e(t),Error("Failed to fetch resource")}).catch(function(t){a(t)})})}},{key:"getExperimentDetail",value:function(i){var n=this,s=void 0;return new Promise(function(e,a){var t={Authorization:"Bearer "+n.AccessToken};fetch("https://api.optimizely.com/v2/experiments/"+i,{method:"GET",headers:t}).then(function(t){return s=t.status,t.json()}).then(function(t){throw 200===s&&e(t),Error("Failed to fetch resource")}).catch(function(t){a(t)})})}},{key:"getAudiences",value:function(){var n=this,s=void 0;return new Promise(function(e,a){var t={Authorization:"Bearer "+n.AccessToken},i="https://api.optimizely.com/v2/audiences?project_id="+n.ProjectId;fetch(i,{method:"GET",headers:t}).then(function(t){return s=t.status,t.json()}).then(function(t){throw 200===s&&e(t),Error("Failed to fetch resource")}).catch(function(t){a(t)})})}},{key:"experimentStartOrStop",value:function(i,n){var s=this,r=void 0;return new Promise(function(e,a){var t={Authorization:"Bearer "+s.AccessToken,"Content-Type":"application/json"};fetch("https://api.optimizely.com/v2/experiments/"+i+"?action="+n,{method:"PATCH",headers:t,body:JSON.stringify({project_id:s.ProjectId})}).then(function(t){return r=t.status,t.json()}).then(function(t){throw 200===r&&e(t),Error("Failed to fetch resource")}).catch(function(t){a(t)})})}}]),i}();function renderToShowExperimentDetails(t){($(".experiment-data, .experiment-key, .audiences").empty(),$(".experiment-key").append('<div class="btn-container"><button class="btn goBack" data-toggle="tooltip" title="Go Back" type="button"><i class="back fa fa-angle-left"></i></button> <div class="keyLabel">'+t.key+"</div> </div>"),t.variations.forEach(function(t){void 0===t.description?$(".experiment-data").append('<tr><td id="'+t.key+'" class="key">'+t.key+'</td><td data-toggle="tooltip" title="Copy Variation Key"><button class="cpbtn" data-clipboard-target="#'+t.key+'"><i class="fa fa-copy"></i></button></td><td class="weight"> '+t.weight/100+"%</td>"):$(".experiment-data").append('<tr><td data-toggle="tooltip" title="Description :  '+t.description+'"  id="'+t.key+'" class="key">'+t.key+'</td><td data-toggle="tooltip" title="Copy Variation Key"><button class="cpbtn" data-clipboard-target="#'+t.key+'"><i class="fa fa-copy"></i></button></td><td class="weight"> '+t.weight/100+"%</td>")}),$(".audiences").append('<div data-toggle="tooltip" title="Audiences" class="audienceLabel"><a class="audienceLink" href="" target="_blank"> <div class="audience-btn"></div>Audiences<i class="link fa fa-external-link"></i></a></div>'),"everyone"!==t.audience_conditions)?JSON.parse("["+t.audience_conditions+"]").forEach(function(t){t.forEach(function(e){"string"!=typeof e&&audiences.forEach(function(t){t.id===e.audience_id&&$(".audiences").append('<div class="keyName" id="'+t.id+'">'+t.name+"</div>")})})}):$(".audiences").append('<div class="keyName">Everyone</div>');$("#loader").hide(),$(".experiment-container").show(),domChangeListnerOfExperimentDetailPage()}function renderToListExperiments(t){$(".experiment-list").empty(),t.forEach(function(t){"not_started"===t.status&&(void 0===t.description||t.description.length<=0?$(".experiment-list").append('<tr><td data-toggle="tooltip" title="Type :  '+t.type+'" class="details" id="'+t.id+'">'+t.key+'</td>\n    + <td class="edit"><p data-placement="top" data-toggle="tooltip" title="Run"><button id="start" class="action" data-title="Run"><span><i class="fa fa-play"></i></span></button></p></td>\n    + <td class="result"><p data-placement="top" data-toggle="tooltip" title="Result"><a target="_blank" href="" id="'+t.campaign_id+'" class="result-icon disabled"><i class="fa fa-bar-chart"></i></a></p></td>\n    + </tr>'):$(".experiment-list").append('<tr><td data-toggle="tooltip" title="Type :  '+t.type+" \n Description :  "+t.description+'" class="details" id="'+t.id+'">'+t.key+'</td>\n    <td class="edit"><p data-placement="top" data-toggle="tooltip" title="Run"><button id="start" class="action" data-title="Run"><span><i class="fa fa-play"></i></span></button></p></td>\n    <td class="result"><p data-placement="top" data-toggle="tooltip" title="Result"><a target="_blank" href="" id="'+t.campaign_id+'" class="result-icon disabled"><i class="fa fa-bar-chart"></i></a></p></td>\n    </tr>')),"paused"===t.status&&(void 0===t.description||t.description.length<=0?$(".experiment-list").append('<tr><td data-toggle="tooltip" title="Type :  '+t.type+'" class="details" id="'+t.id+'">'+t.key+'</td>\n    <td class="edit"><p data-placement="top" data-toggle="tooltip" title="Run"><button id="start" class="action" data-title="Run"><span><i class="fa fa-play"></i></span></button></p></td>\n    <td class="result"><p data-placement="top" data-toggle="tooltip" title="Result"><a target="_blank" href="" id="'+t.campaign_id+'"><button class="result-icon"><span><i class="fa fa-bar-chart"></i></span></button></p></td>\n    </tr>'):$(".experiment-list").append('<tr><td data-toggle="tooltip" title="Type :  '+t.type+" \n Description :  "+t.description+'" class="details" id="'+t.id+'">'+t.key+'</td>\n    <td class="edit"><p data-placement="top" data-toggle="tooltip" title="Run"><button id="start" class="action" data-title="Run"><span><i class="fa fa-play"></i></span></button></p></td>\n    <td class="result"><p data-placement="top" data-toggle="tooltip" title="Result"><a target="_blank" href="" id="'+t.campaign_id+'"><button class="result-icon"><span><i class="fa fa-bar-chart"></i></span></button></p></td>\n    </tr>')),"running"===t.status&&(void 0===t.description||t.description.length<=0?$(".experiment-list").append('<tr><td data-toggle="tooltip" title="Type :  '+t.type+'" class="details" id="'+t.id+'">'+t.key+'</td>\n   <td class="edit"><p data-placement="top" data-toggle="tooltip" title="Pause"><button id="pause" class="action" data-title="Pause"><span><i class="fa fa-pause"></i></span></button></p></td>\n    <td class="result"><p data-placement="top" data-toggle="tooltip" title="Result"><a target="_blank" href="" id="'+t.campaign_id+'"><button class="result-icon"><span><i class="fa fa-bar-chart"></i></span></button></p></td>\n   </tr>'):$(".experiment-list").append('<tr><td data-toggle="tooltip" title="Type :  '+t.type+" \n Description :  "+t.description+'" class="details" id="'+t.id+'">'+t.key+'</td>\n    <td class="edit"><p data-placement="top" data-toggle="tooltip" title="Pause"><button id="pause" class="action" data-title="Pause"><span><i class="fa fa-pause"></i></span></button></p></td>\n   <td class="result"><p data-placement="top" data-toggle="tooltip" title="Result"><a target="_blank" href="" id="'+t.campaign_id+'"><button class="result-icon"><span><i class="fa fa-bar-chart"></i></span></button></a></p></td>\n    </tr>'))}),$("#loader").hide(),$(".container").show(),domChangeListnerOfExperimentsListPage()}function domChangeListnerOfExperimentDetailPage(){$(".goBack").click(function(){$(".experiment-data, .experiment-key, .audiences").empty(),$(".labell").css({display:"block"}),$(".new-experiment").css({display:"block"}),$(".table-responsive, .refresh-btn").show(),$(".experiment-container").hide(),$(".new-experiment-container").hide()}),$(".audienceLink").click(function(t){var e="https://app.optimizely.com/v2/projects/"+extensionField.config.project_id+"/audiences";$(t.currentTarget).attr("href",e)})}function domChangeListnerOfExperimentsListPage(){$(".details").click(function(t){var e=t.currentTarget.id;optimizely.getExperimentDetail(e).then(function(t){renderToShowExperimentDetails(t)}),$(".delete-container, .list, .edit-container, .new-experiment-container, .refresh-btn").hide(),$(".labell").css({display:"none"}),$(".new-experiment").css({display:"none"}),$("#loader").show()}),$(".result-icon").click(function(t){console.log(t.currentTarget,t.current);var e=$(t.currentTarget).parent("a").attr("id"),a=$(t.currentTarget).parent().parent().parent().siblings(".details").attr("id"),i="https://app.optimizely.com/v2/projects/"+extensionField.config.project_id+"/results/"+e+"/experiments/"+a+"?previousView=EXPERIMENTS";$(t.currentTarget).parent("a").attr("href",i)}),$(".add").click(function(t){var e="https://app.optimizely.com/v2/projects/"+extensionField.config.project_id+"/experiments";$(t.currentTarget).parent("a").attr("href",e)}),$(".action").click(function(t){var e=t.currentTarget.id;$(t.currentTarget).find("span").html('<i class="fa fa-spinner fa-spin"></i>'),$(t.currentTarget).attr("disabled","disabled");var a=$(t.currentTarget).parent().parent().siblings(".details").attr("id");optimizely.experimentStartOrStop(a,e).then(function(){$(t.currentTarget).parent().parent().parent().find(".result").find(".result-icon").removeClass("disabled"),"start"===e?($(t.currentTarget).attr("id","pause").attr("data-title","Pause"),$(t.currentTarget).parent().attr("title","Pause"),$(t.currentTarget).find("span").html('<i class="fa fa-pause"></i>')):($(t.currentTarget).attr("id","start").attr("data-title","Run"),$(t.currentTarget).parent().attr("title","Run"),$(t.currentTarget).find("span").html('<i class="fa fa-play">')),$(t.currentTarget).removeAttr("disabled")})}),$(".refresh-btn").click(function(){$(".container").hide(),$("#loader").show(),optimizely.getAllExperiments().then(function(t){renderToListExperiments(t)})})}$(document).ready(function(){ContentstackUIExtension.init().then(function(t){extensionField=t,$("#loader").show(),(optimizely=new Optimizely(t.config)).getAllExperiments().then(function(t){renderToListExperiments(t)}),optimizely.getAudiences().then(function(t){audiences=t}),extensionField.window.enableAutoResizing()})});
</script>
</body>

</html>